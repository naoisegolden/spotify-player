!function(){"use strict";function onFormSubmit(event){event.preventDefault();var query=event.target[0].value;searchTrack(query)}function onPlayClick(event){event.preventDefault(),audio.paused&&audio.duration?(this.classList.add("playing"),audio.play()):(this.classList.remove("playing"),audio.pause())}function onAudioTimeupdate(){progress.value=this.currentTime}function onAudioEnded(){progress.value=0,play.classList.remove("playing")}function onResultsClick(event){if(event.preventDefault(),!this.matches(".empty")){var link=parents(event.target,".uri"),uri=link.href;loadURI(uri,function(){audio.play(),link.parentElement.classList.add("selected")})}}function ajax(url,callback){var xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.setRequestHeader("Accept","application/json"),xhr.send(),xhr.onload=function(){200===this.status?callback(JSON.parse(this.response)):alert("Error accessing fetching data.")}}function searchTrack(query){var url=SEARCH_URL+encodeURIComponent(query);ajax(url,updateList)}function updateList(response){var songs=response.tracks.items;results.innerHTML="",results.classList.add("empty"),0!==songs.length&&(songs.forEach(function(track){var tmplt=TEMPLATE,song=track.name,uri=track.uri,artist=track.artists.map(function(artist){return artist.name}).join(", ");tmplt=tmplt.replace(/{uri}/,uri),tmplt=tmplt.replace(/{artist}/,artist),tmplt=tmplt.replace(/{song}/,song),results.innerHTML+=tmplt}),results.classList.remove("empty"))}function parents(element,selector){return element.matches(selector)?element:parents(element.parentElement,selector)}function trackFromUri(uri){try{return uri.split(":")[2]}catch(error){throw new Error("Track URI has wrong format.")}}function loadURI(uri,callback){var track=trackFromUri(uri),url=TRACK_URL+track,resultsArray=Array.prototype.slice.call(results.children);resultsArray.forEach(function(result){result.classList.remove("selected")}),ajax(url,function(response){title.innerHTML=response.name,artist.innerHTML=response.artists[0].name,cover.src=response.album.images[0].url,audio.src=response.preview_url,play.classList.remove("disabled"),play.classList.add("playing"),callback()})}var MAX_RESULTS=10,SEARCH_URL="https://api.spotify.com/v1/search?type=track&limit="+MAX_RESULTS+"&q=",TRACK_URL="https://api.spotify.com/v1/tracks/",TEMPLATE=document.querySelector("#template").innerHTML,progress=document.querySelector(".seekbar progress"),search=document.querySelector("#search"),play=document.querySelector(".btn-play"),audio=document.querySelector("#audio"),results=document.querySelector(".results"),title=document.querySelector(".title"),artist=document.querySelector(".author"),cover=document.querySelector(".cover img");search.addEventListener("submit",onFormSubmit),play.addEventListener("click",onPlayClick),audio.addEventListener("timeupdate",onAudioTimeupdate),audio.addEventListener("ended",onAudioEnded),results.addEventListener("click",onResultsClick)}();